<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<script src="https://code.jquery.com/jquery-3.7.1.min.js"
            integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo="
            crossorigin="anonymous"></script>
</head>
<body>
	<a href="friend/inviteFriend.html">친구관리</a>
	<a href="game/createGameRoom.html">게임 시작</a>
	<a href="game/createGameRoom.html">진행 중인 게임 참가</a>
	<a href="login.html">login</a>
	<a href="register.html">signup</a>
	<a href="#" onclick="submitLogoutForm(); return false;">로그아웃</a>
	
	<!-- 숨겨진 로그아웃 폼 -->
	<form id="logoutForm" action="/my/logout" method="POST" style="display: none;">
	  <input type="hidden" name="_csrf" id="csrfToken">
	</form>
	<script>
function setCsrfToken() {
    return fetch('/csrf-token', {
        method: 'GET',
        credentials: 'same-origin'
    })
    .then(res => res.json())
    .then(data => {
        $('#csrfToken').val(data.token);
        return data.token;
    })
    .catch(err => {
        console.error("CSRF 토큰 불러오기 실패", err);
        return null;
    });
}

async function submitLogoutForm() {
    const token = await setCsrfToken();
    if (token) {
        document.getElementById('logoutForm').submit();
    } else {
        alert("CSRF 토큰을 찾을 수 없습니다. 페이지를 새로고침 해보세요.");
    }
}

$(document).ready(function () {
    setCsrfToken();
});
</script>

</body>
</html>